 
<section id  ="gestion-content-cuenta">
    <section id = "gestion-content-title">
            <h5>Cuenta Nombre</h5>
            <hr>
    </section>
   
        <section id = "gestion-content-informacion">
         <mat-tab-group>
                @if(banderaCuentaTiene == true){
                <mat-tab label="Información de cuenta"> 
                   <section class="gestion-info-cuenta">
                        <div class ="gestion-info">
                            <p><strong>Banco:</strong> Banco Ejemplo S.A.</p>
                            <p><strong>Titular:</strong> Cliente Anónimo</p>
                            <p><strong>Número de cuenta:</strong> ****5678</p>
                            <p><strong>Tipo de cuenta:</strong> Cuenta corriente</p>
                            <p><strong>Moneda:</strong> USD</p>
                            <p><strong>Periodo:</strong> 2025-09-01 a 2025-09-30</p>
                            <p><strong>Saldo de apertura:</strong> $1250.00</p>
                            <p><strong>Saldo de cierre:</strong> $1023.85</p>
                        </div>

                        <div class ="gestion-transacciones">
                            <h3>Totales del Mes</h3>
                            <p><strong>Total acreditado:</strong> $1526.23</p>
                            <p><strong>Total debitado:</strong> $1752.38</p>
                            <p><strong>Número de transacciones:</strong> 15</p>
                        </div>
                    </section>
                </mat-tab>
                }
                <mat-tab label="Transacciones Información"> 
                    <section class="gestion-table-content">
                        <table mat-table [dataSource]="placeholderTransacciones" class="mat-elevation-z2" style="width:100%;">

                        
                            <ng-container matColumnDef="fecha">
                            <th mat-header-cell *matHeaderCellDef>Fecha</th>
                            <td mat-cell *matCellDef="let t">{{ t.fecha }}</td>
                            </ng-container>

                            <ng-container matColumnDef="descripcion">
                            <th mat-header-cell *matHeaderCellDef>Descripción</th>
                            <td mat-cell *matCellDef="let t">{{ t.descripcion }}</td>
                            </ng-container>


                            <ng-container matColumnDef="tipo">
                            <th mat-header-cell *matHeaderCellDef>Tipo</th>
                            <td mat-cell *matCellDef="let t">
                                <span>
                                {{ t.tipo }}
                                </span>
                            </td>
                            </ng-container>

                            <ng-container matColumnDef="monto">
                            <th mat-header-cell *matHeaderCellDef>Monto</th>
                            <td mat-cell *matCellDef="let t">${{ t.monto }}</td>
                            </ng-container>

                            <ng-container matColumnDef="balance">
                            <th mat-header-cell *matHeaderCellDef>Balance</th>
                            <td mat-cell *matCellDef="let t">${{ t.balance }}</td>
                            </ng-container>

                            <ng-container matColumnDef="canal">
                            <th mat-header-cell *matHeaderCellDef>Canal</th>
                            <td mat-cell *matCellDef="let t">{{ t.canal}}</td>
                            </ng-container>
                            
                            <ng-container matColumnDef="referencia">
                            <th mat-header-cell *matHeaderCellDef>Referencia</th>
                            <td mat-cell *matCellDef="let t">{{ t.referencia }}</td>
                            </ng-container>

                            <tr mat-header-row *matHeaderRowDef="['fecha','descripcion','tipo','monto','balance','canal', 'referencia']"></tr>
                            <tr mat-row *matRowDef="let row; columns: ['fecha','descripcion','tipo','monto','balance','canal', 'referencia'];"></tr>
                        </table>
                        </section>
                </mat-tab>
        </mat-tab-group>
    </section>

    <!--Que se muestre de último-->
    <section id = "gestion-cuenta-contenedor">
        <div class = "gestion-grafica-costos">
            <mat-accordion>

            
            <mat-expansion-panel>
                <mat-expansion-panel-header>
                <mat-panel-title> Transacciones </mat-panel-title>
                <mat-panel-description> Resumen descriptivo </mat-panel-description>
                </mat-expansion-panel-header>

                <h6>Transacciones: </h6>
                <p><strong>CARGOS:</strong> {{transaccionesResumen.cantidadCargos}}</p>
                <p><strong>ABONOS:</strong> {{transaccionesResumen.cantidadAbonos}}</p>

                <h6>Promedio por transacción:</h6>
                <p><strong>Promedio Cargos:</strong> ${{transaccionesResumen.promedioCargo}}</p>
                <p><strong>Promedio Abonos:</strong> ${{transaccionesResumen.promedioAbono}}</p>

                <h6>Total de dinero:</h6>
                <p><strong>Total Cargos:</strong> ${{transaccionesResumen.totalCargos}}</p>
                <p><strong>Total Abonos:</strong> ${{transaccionesResumen.totalAbonos}}</p> 
            </mat-expansion-panel>

            
            <mat-expansion-panel>
                <mat-expansion-panel-header>
                <mat-panel-title> Movimiento </mat-panel-title>
                <mat-panel-description> Frecuencia y ritmo de transacciones </mat-panel-description>
                </mat-expansion-panel-header>

                <h6>Movimiento en días (desde la primera hasta la última transacción)</h6>
                <p><strong>Días entre transacciones:</strong> {{transaccionesFrecuencia.diasEntreTransacciones}}</p>
                <p><strong>Total de transacciones:</strong> {{transaccionesFrecuencia.totalTransacciones}}</p>
            </mat-expansion-panel>

           
            <mat-expansion-panel>
                <mat-expansion-panel-header>
                <mat-panel-title> Patrones </mat-panel-title>
                <mat-panel-description> Análisis de Cargos y Abonos por canal </mat-panel-description>
                </mat-expansion-panel-header>

                
                <section class="patron-section">
                <h6>Transacciones <strong class="abono">Abonos</strong></h6>
                <div class="info-block">
                    <p><strong>Total Abonos:</strong> ${{ patronesCredito.totalAbonos }}</p>
                    <p><strong>Cantidad:</strong> {{ patronesCredito.cantidad }}</p>
                    <h6><strong>Canales:</strong></h6>

                    <div class="canales-container">
                    <div class="canal-card mat-elevation-z2" >
                        @for(canal of transformarCanales(patronesCredito.canales); track $index){
                            <h6>{{ canal.canal }}</h6>
                        <p><strong>Transacciones:</strong> {{ canal.cantidad }}</p>
                        <p><strong>Monto total:</strong> ${{ canal.montoTotal }}</p>
                        }
                    </div>
                    </div>
                </div>
                </section>

                <mat-divider class="my-3"></mat-divider>

                
                <section class="patron-section">
                <h6>Transacciones <strong class="cargo">Cargos</strong></h6>
                <div class="info-block">
                    <p><strong>Total Cargos:</strong> ${{ patronesDebito.totalCargos }}</p>
                    <p><strong>Cantidad:</strong> {{ patronesDebito.cantidad }}</p>
                    <h6><strong>Canales:</strong></h6>

                    <div class="canales-container">
                    <div class="canal-card mat-elevation-z2" >
                        @for(canal of transformarCanales(patronesDebito.canales); track $index){
                            <h6>{{ canal.canal }}</h6>
                        <p><strong>Transacciones:</strong> {{ canal.cantidad }}</p>
                        <p><strong>Monto total:</strong> ${{ canal.montoTotal }}</p>
                        }
                        
                    </div>
                    </div>
                </div>
                </section>

            </mat-expansion-panel>
            </mat-accordion>
            <div class = "gestion-KPIS">
                <div class ="KPIS-carta">
                    <div class = "kpi-card-title">
                        <h4>Tendendia de deuda</h4>
                    </div>
                    <div class = "kpi-content">
                        <p>Tu saldo actualmente es: ${{tendenciaSaldo.saldoFinal}}</p>
                        <p>Limite de saldo en tarjeta: ${{tendenciaSaldo.saldoLimite}}</p>
                    </div>
                    <div classs = "kpi-warning">
                        <!--NGclass para darle un color de acorde al porcentaje-->
                        <p>Tu deuda es actualmente un {{banderaPorcentaje}}% del saldo total de la tarjeta</p>
                        <p>Intereses después de fecha corte: ${{(tendenciaSaldo.saldoFinal*(tendenciaSaldo.tazaInteres/100)).toFixed(2)}}</p>
                        <!--If de acorde al porcentaje-->
                       @if(banderaPorcentaje >35){
                         <div class = "kpi-advanced-adivce">
                            <p>¡Tienes la deuda muy alta!</p>
                            <span>
                                Un porcentaje aceptable de deuda es por debajo del 30%.
                            </span>
                            <div class ="kpi-data">
                                <p>¿Que hacer?</p>
                                <ul>
                                    <li>Abona más del pago mínimo a tu deuda (Abonos > ${{tendenciaSaldo.pagoMinimo}} )</li>
                                    <li>Haz tus abonos antes de la fecha de corte (Fecha de corte: {{tendenciaSaldo.fechaCorte}}) </li>
                                    <li>Administra tus gastos (Más flujo de saldo en: {{flujoSaldo.categoria}}: ${{flujoSaldo.costo}})</li>
                                </ul>
                            </div>
                        </div>
                       }@else {
                            <div class = "kpi-advanced-adivce">
                            <p>Estas dentro de un margen aceptable de deuda</p>
                            <span>
                                Un porcentaje aceptable de deuda es por debajo del 30%.
                            </span>
                            <div class ="kpi-data">
                                <p>¿Que sigue ahora?</p>
                                <ul>
                                    <li>Sigue tratando de abonar más del pago mínimo a tu deuda (Abonos > ${{tendenciaSaldo.pagoMinimo}})</li>
                                    <li>Haz tus abonos antes de la fecha de corte (Fecha de corte: {{tendenciaSaldo.fechaCorte}}) </li>
                                    <li>Administra tus gastos (Más flujo de saldo en: {{flujoSaldo.categoria}}: ${{flujoSaldo.costo}})</li>
                                </ul>
                            </div>
                        </div>
                       }
                    </div>
                </div>
                <div class ="KPIS-carta">
                    <div class = "kpi-card-title">
                        <h4>Fecha de corte</h4>
                    </div>
                    <div class = "kpi-content">
                        <p>Tu próxima fecha de corte es: {{tendenciaSaldo.fechaCorte}}</p>
                        <p>¡Tienes que pagar antes de la fecha de corte para no cobrar interes de ${{tendenciaSaldo.saldoFinal}}</p>
                        <small>Intereses hasta ahora: ${{(tendenciaSaldo.saldoFinal*(tendenciaSaldo.tazaInteres/100)).toFixed(2)}}. Tasa de Interes Anual: {{tendenciaSaldo.tazaInteres}}%</small>
                    </div>
                </div>
                <div class ="KPIS-carta">
                    <div class = "kpi-card-title">
                        <h4>Frecuencia de Uso</h4>
                    </div>
                    <div class = "kpi-content">
                        <p>Tienes un promedio de uso de: {{transaccionesFrecuencia.diasEntreTransacciones}} días</p>
                        @if(transaccionesFrecuencia.diasEntreTransacciones>2){
                            <p>Tienes una dependencia al credito, ya que tienes un promedio de uso elevado</p>
                        }@else {
                            <p>El uso de tu tarjeta de credito está dentro de un margen aceptable</p>
                        }
                        <p>Categoría dónde más gastas: {{flujoSaldo.categoria}}</p>
                    </div>
                    <div classs = "kpi-warning">
                        <!--NGclass para darle un color de acorde al porcentaje-->
                        <p>El promedio de todas tus compras ronda entre los: ${{(banderaPromedioGasto)}} </p>
                        <p>A este ritmo, tu credito se irá en tan solo: {{banderaDias}} semanas</p>
                        <!--If de acorde al porcentaje-->
                        @if(banderaDias >3){
                            <div class = "kpi-advanced-adivce">
                                <p>¡Tu credito puede acabar rápido si no lo administras bien!</p>
                                <div class ="kpi-data">
                                    <p>¿Que hacer?</p>
                                    <ul>
                                        <li>Distribuye y mitiga gastos pasivos</li>
                                        <li>Convierte en prioridades tus gastos vitalisios</li>
                                        <li>El dinero prestado nunca es dinero regalado</li>
                                    </ul>
                                </div>
                            </div>
                        }@else{
                            <div class = "kpi-advanced-adivce">
                                <p>Tu credito está en un margen aceptable, aún puede durar bastante</p>
                                <div class ="kpi-data">
                                    <p>¿Que hacer?</p>
                                    <ul>
                                        <li>Distribuye y mitiga gastos pasivos</li>
                                        <li>Convierte en prioridades tus gastos vitalisios</li>
                                        <li>El dinero prestado nunca es dinero regalado</li>
                                    </ul>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
        <div class = "gestion-distribucion-costos">
            <canvas id="graficaRadar"></canvas>
        </div>
        <section id = "gestion-form-transaccion">
            <section id = "gestion-modal">
                <button class = "gestion-modal-button" (click)="openModal()">
                    Agregar transacciones
                </button> 
            </section>
        </section>
        <!-- Modal -->
        <div class="modal" [class.show]="isModalOpen">
            <div class="modal-content">
                <span class="close" (click)="closeModal()">&times;</span>
                <div class = "gestion-form">
                    <form id="formulario-transaccion" [formGroup]="formulario" >
                        <div class = "form-transaccion">
                            <label>Tipo de transacción</label>
                            <select formControlName = "selectCargo">
                                <option value ="CARGO">Cargo</option>
                                <option value = "ABONO">Abono</option>
                            </select>
                        </div>
                        <div class = "form-transaccion">
                            <label>Monto</label>
                            <input formControlName = "inputMonto" type = "number" min = 0 max = 10000 step =10 >
                        </div>
                        <div class = "form-categoria">
                            <label>Categoria de transacción</label>
                            @if(banderaOtros == false){
                                <select formControlName = "inputCategoria">
                                    <option value = "compra">Compras</option>
                                    <option value ="retiro">Retiros</option>
                                    <option value = "interéss"d>Intereses</option>
                                    <option value = "comisión">Comisiones</option>
                                    <option value = "pago">Pagos</option>
                                    <option value = "transferencia">Transferencia</option>
                                <option value ="otros">Otros</option>
                            </select>
                            }@else {
                                <input type = "text" placeholder = "Escribe la categoria nueva..."  formControlName = "inputCategoria" value = "a">
                            }
                        </div>
                        <div class ="form-canal">
                            <label>Canal de transacción</label>
                           @if(banderaOtros1 ==false){
                             <select formControlName = "inputCanal">
                               @for(canal of arrayAuxiliar; track $index){
                                     @if($index ==0){
                                        <option value = {{canal}} selected>{{canal}}</option>
                                    }
                                    @else {
                                        <option value = {{canal}}>{{canal}}</option>
                                    }
                               }
                               <option value = otro>Otro...</option>
                            </select>
                           }@else {
                                <input formControlName = "inputCanal" type = "text" placeholder = "Escribe la categoria nueva..." value = "a" >
                           }
                        </div>
                        <div class ="form-fecha">
                            <label>Fecha de transacción</label>
                            <input type = "date" formControlName = "dateFecha">
                        </div>
                        <div class ="form-referencia">
                            <label>Detalla la referencia de transacción</label>
                            <input formControlName = "inputDetalle" type = "text" placeholder = "Escribe el texto largo aburrido...">
                        </div>
                        <div class ="form-buttons">
                            <button type ="submit" (click)="onSubmit()">Enzviar</button>
                            <button type = "button" (click)="closeModal()">Cerrar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>
    

</section>
